<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    <title>Album Art Recommendation</title>

    <link rel="stylesheet" href="./Styles/master.css">
    <script type="text/javascript">
      fetch('http://localhost:5000/init').then(response => {
        return response.json();
      }).then(result => {
        let current = document.getElementById('current');
        current.src = result.img;
        current.alt = result.index;

        let data = {index: result.index};

        fetch('http://localhost:5000/suggest', {
          method: 'POST',
          mode: 'cors',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        }).then(response => {

          return response.json();
        }).then(result => {
            let items = Object.entries(result);
            let iterator = items.entries();

            for(let [index, item] of iterator) {
              recs[index].src = item[1];
              recs[index].alt = item[0];
            }
        });


      });
    </script>
  </head>
  <body>
      <main>
        <h1>Album Recommendation</h1>
        <img src="" id="current" alt="">
        <button type="button" name="button">Shuffle</button>
        <div id="rec">
          <img src="" class="rec-img" alt="">
          <img src="" class="rec-img" alt="">
          <img src="" class="rec-img" alt="">
          <img src="" class="rec-img" alt="">
          <img src="" class="rec-img" alt="">
        </div>
      </main>
  </body>

  <script type="text/javascript">
    let b = document.querySelector('button');
    let recs = document.getElementsByClassName('rec-img');
    let current = document.getElementById('current');


    for(r of recs) {
      r.addEventListener('click', e => {
        current.src = e.target.src;
        current.alt = e.target.alt;

        let data = {index: e.target.alt};

        fetch('http://localhost:5000/suggest', {
          method: 'POST',
          mode: 'cors',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        }).then(response => {

          return response.json();
        }).then(result => {
            let items = Object.entries(result);
            let iterator = items.entries();

            for(let [index, item] of iterator) {
              recs[index].src = item[1];
              recs[index].alt = item[0];
            }
        });

      });
    }

    b.addEventListener('click', e => {
      let img = document.getElementById('current');

      fetch('http://localhost:5000/init').then(response => {
        return response.json();
      }).then(result => {
        let current = document.getElementById('current');
        current.src = result.img;
        current.alt = result.index;

        let data = {index: result.index};

        fetch('http://localhost:5000/suggest', {
          method: 'POST',
          mode: 'cors',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        }).then(response => {

          return response.json();
        }).then(result => {
            let items = Object.entries(result);
            let iterator = items.entries();

            for(let [index, item] of iterator) {
              recs[index].src = item[1];
              recs[index].alt = item[0];
            }
        });
      });
    });
  </script>
</html>
